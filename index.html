<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡¶ñ‡¶∞‡¶ö ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶∞</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Noto Sans Bengali', sans-serif;
    }
    .expense-card {
      transition: transform 0.2s, opacity 0.2s;
    }
    .expense-card:hover {
      transform: scale(1.02);
    }
    @media (max-width: 640px) {
      .desktop-table {
        display: none;
      }
    }
    @media (min-width: 641px) {
      .mobile-cards {
        display: none;
      }
    }
  </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen transition-colors duration-300">
  <div class="container mx-auto p-4 sm:p-6 max-w-4xl">
    <!-- ‡¶°‡¶æ‡¶∞‡ßç‡¶ï ‡¶Æ‡ßã‡¶° ‡¶ü‡¶ó‡¶≤ -->
    <div class="flex justify-end mb-4">
      <button id="themeToggle" class="bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-100 p-2 rounded-full">
        üåô
      </button>
    </div>

    <h1 class="text-2xl sm:text-3xl font-bold text-center mb-6">‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ñ‡¶∞‡¶ö ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶∞</h1>

    <!-- ‡¶´‡¶∞‡ßç‡¶Æ -->
    <div class="bg-white dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow-md mb-6">
      <h2 class="text-lg sm:text-xl font-semibold mb-4">‡¶®‡¶§‡ßÅ‡¶® ‡¶ñ‡¶∞‡¶ö ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <input type="date" id="date" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100" required>
        <input type="text" id="description" placeholder="‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ (‡¶Ø‡ßá‡¶Æ‡¶®, ‡¶¨‡¶æ‡¶ú‡¶æ‡¶∞)" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100" required>
        <input type="number" id="amount" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100" required>
        <select id="category" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
          <option value="‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞">‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞</option>
          <option value="‡¶™‡¶∞‡¶ø‡¶¨‡¶π‡¶®">‡¶™‡¶∞‡¶ø‡¶¨‡¶π‡¶®</option>
          <option value="‡¶¨‡¶ø‡¶®‡ßã‡¶¶‡¶®">‡¶¨‡¶ø‡¶®‡ßã‡¶¶‡¶®</option>
          <option value="‡¶¨‡¶ø‡¶≤">‡¶¨‡¶ø‡¶≤</option>
          <option value="‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</option>
        </select>
        <input type="text" id="notes" placeholder="‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)" class="border p-2 rounded w-full sm:col-span-2 bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
        <button onclick="addExpense()" class="bg-blue-500 text-white p-2 rounded hover:bg-blue-600 sm:col-span-2 text-lg">‡¶ñ‡¶∞‡¶ö ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      </div>
    </div>

    <!-- ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü -->
    <div class="bg-white dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow-md mb-6">
      <h2 class="text-lg sm:text-xl font-semibold mb-4">‡¶ñ‡¶∞‡¶ö ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h2>
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4">
        <input type="date" id="filterStartDate" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100" placeholder="‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ">
        <input type="date" id="filterEndDate" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100" placeholder="‡¶∂‡ßá‡¶∑‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ">
        <select id="filterCategory" class="border p-2 rounded w-full bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
          <option value="">‡¶∏‡¶¨ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</option>
          <option value="‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞">‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞</option>
          <option value="‡¶™‡¶∞‡¶ø‡¶¨‡¶π‡¶®">‡¶™‡¶∞‡¶ø‡¶¨‡¶π‡¶®</option>
          <option value="‡¶¨‡¶ø‡¶®‡ßã‡¶¶‡¶®">‡¶¨‡¶ø‡¶®‡ßã‡¶¶‡¶®</option>
          <option value="‡¶¨‡¶ø‡¶≤">‡¶¨‡¶ø‡¶≤</option>
          <option value="‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</option>
        </select>
      </div>
      <div class="flex flex-wrap gap-4">
        <button onclick="filterExpenses()" class="bg-green-500 text-white p-2 rounded hover:bg-green-600 text-lg flex-1 min-w-[100px]">‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        <button onclick="exportToCSV()" class="bg-purple-500 text-white p-2 rounded hover:bg-purple-600 text-lg flex-1 min-w-[100px]">CSV ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
        <button onclick="printExpenses()" class="bg-gray-500 text-white p-2 rounded hover:bg-gray-600 text-lg flex-1 min-w-[100px]">‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      </div>
    </div>

    <!-- ‡¶ñ‡¶∞‡¶ö‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ -->
    <div class="bg-white dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow-md mb-6">
      <h2 class="text-lg sm:text-xl font-semibold mb-4">‡¶ñ‡¶∞‡¶ö‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h2>
      <!-- ‡¶°‡ßá‡¶∏‡ßç‡¶ï‡¶ü‡¶™ ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ -->
      <div class="desktop-table overflow-x-auto">
        <table class="w-full text-left border-collapse">
          <thead>
            <tr class="bg-gray-200 dark:bg-gray-700">
              <th class="p-2 border dark:border-gray-600">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
              <th class="p-2 border dark:border-gray-600">‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th>
              <th class="p-2 border dark:border-gray-600">‡¶ü‡¶æ‡¶ï‡¶æ</th>
              <th class="p-2 border dark:border-gray-600">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</th>
              <th class="p-2 border dark:border-gray-600">‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø</th>
              <th class="p-2 border dark:border-gray-600">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
            </tr>
          </thead>
          <tbody id="expenseTable"></tbody>
        </table>
      </div>
      <!-- ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶ï‡¶æ‡¶∞‡ßç‡¶° -->
      <div class="mobile-cards space-y-4" id="expenseCards"></div>
      <p class="mt-4 text-lg font-semibold">‡¶Æ‡ßã‡¶ü ‡¶ñ‡¶∞‡¶ö: <span id="totalAmount">0</span> ‡¶ü‡¶æ‡¶ï‡¶æ</p>
    </div>

    <!-- ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü -->
    <div class="bg-white dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow-md">
      <h2 class="text-lg sm:text-xl font-semibold mb-4">‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h2>
      <div class="mb-4">
        <input type="month" id="reportMonth" class="border p-2 rounded bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
      </div>
      <div id="monthlyReport" class="text-base sm:text-lg"></div>
    </div>
  </div>

  <script>
    let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
    let filteredExpenses = [...expenses];

    // ‡¶°‡¶æ‡¶∞‡ßç‡¶ï ‡¶Æ‡ßã‡¶° ‡¶ü‡¶ó‡¶≤
    const themeToggle = document.getElementById('themeToggle');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    if (prefersDark.matches) document.body.classList.add('dark');
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark');
      localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
    });
    if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark');

    function addExpense() {
      const date = document.getElementById('date').value;
      const description = document.getElementById('description').value;
      const amount = parseFloat(document.getElementById('amount').value);
      const category = document.getElementById('category').value;
      const notes = document.getElementById('notes').value;

      if (!date || !description || !amount) {
        alert('‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ, ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶è‡¶¨‡¶Ç ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!');
        return;
      }

      const expense = { date, description, amount, category, notes };
      expenses.push(expense);
      localStorage.setItem('expenses', JSON.stringify(expenses));
      filteredExpenses = [...expenses];
      renderExpenses();
      clearForm();
      generateMonthlyReport();
    }

    function deleteExpense(index) {
      expenses.splice(index, 1);
      localStorage.setItem('expenses', JSON.stringify(expenses));
      filteredExpenses = [...expenses];
      renderExpenses();
      generateMonthlyReport();
    }

    function renderExpenses() {
      const tableBody = document.getElementById('expenseTable');
      const cardContainer = document.getElementById('expenseCards');
      tableBody.innerHTML = '';
      cardContainer.innerHTML = '';
      let total = 0;

      filteredExpenses.forEach((expense, index) => {
        total += expense.amount;

        // ‡¶°‡ßá‡¶∏‡ßç‡¶ï‡¶ü‡¶™ ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤
        const row = `
          <tr>
            <td class="p-2 border dark:border-gray-600">${expense.date}</td>
            <td class="p-2 border dark:border-gray-600">${expense.description}</td>
            <td class="p-2 border dark:border-gray-600">${expense.amount}</td>
            <td class="p-2 border dark:border-gray-600">${expense.category}</td>
            <td class="p-2 border dark:border-gray-600">${expense.notes}</td>
            <td class="p-2 border dark:border-gray-600">
              <button onclick="deleteExpense(${index})" class="text-red-500 hover:underline">‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
            </td>
          </tr>`;
        tableBody.innerHTML += row;

        // ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶ï‡¶æ‡¶∞‡ßç‡¶°
        const card = `
          <div class="expense-card bg-gray-50 dark:bg-gray-700 p-4 rounded-lg shadow">
            <p><strong>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</strong> ${expense.date}</p>
            <p><strong>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£:</strong> ${expense.description}</p>
            <p><strong>‡¶ü‡¶æ‡¶ï‡¶æ:</strong> ${expense.amount}</p>
            <p><strong>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø:</strong> ${expense.category}</p>
            <p><strong>‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø:</strong> ${expense.notes || '-'}</p>
            <button onclick="deleteExpense(${index})" class="text-red-500 hover:underline mt-2">‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
          </div>`;
        cardContainer.innerHTML += card;
      });

      document.getElementById('totalAmount').textContent = total.toFixed(2);
    }

    function clearForm() {
      document.getElementById('date').value = '';
      document.getElementById('description').value = '';
      document.getElementById('amount').value = '';
      document.getElementById('category').value = '‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞';
      document.getElementById('notes').value = '';
    }

    function filterExpenses() {
      const startDate = document.getElementById('filterStartDate').value;
      const endDate = document.getElementById('filterEndDate').value;
      const category = document.getElementById('filterCategory').value;

      filteredExpenses = expenses.filter(expense => {
        let matches = true;
        if (startDate && expense.date < startDate) matches = false;
        if (endDate && expense.date > endDate) matches = false;
        if (category && expense.category !== category) matches = false;
        return matches;
      });

      renderExpenses();
    }

    function exportToCSV() {
      const headers = ['‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ,‡¶¨‡¶ø‡¶¨‡¶∞‡¶£,‡¶ü‡¶æ‡¶ï‡¶æ,‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø,‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø'];
      const rows = filteredExpenses.map(expense => 
        `${expense.date},${expense.description},${expense.amount},${expense.category},${expense.notes}`
      );
      const csvContent = headers.concat(rows).join('\n');
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'expenses.csv';
      link.click();
    }

    function printExpenses() {
      const printContent = document.querySelector('.desktop-table').outerHTML;
      const total = document.getElementById('totalAmount').textContent;
      const printWindow = window.open('', '', 'height=600,width=800');
      printWindow.document.write(`
        <html>
          <head>
            <title>‡¶ñ‡¶∞‡¶ö‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</title>
            <style>
              body { font-family: 'Noto Sans Bengali', sans-serif; }
              table { width: 100%; border-collapse: collapse; }
              th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
              th { background-color: #f2f2f2; }
            </style>
          </head>
          <body>
            <h2>‡¶ñ‡¶∞‡¶ö‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h2>
            ${printContent}
            <p><strong>‡¶Æ‡ßã‡¶ü ‡¶ñ‡¶∞‡¶ö: ${total} ‡¶ü‡¶æ‡¶ï‡¶æ</strong></p>
          </body>
        </html>
      `);
      printWindow.document.close();
      printWindow.print();
    }

    function generateMonthlyReport() {
      const reportMonth = document.getElementById('reportMonth').value;
      if (!reportMonth) return;

      const [year, month] = reportMonth.split('-');
      const filteredByMonth = expenses.filter(expense => 
        expense.date.startsWith(`${year}-${month}`)
      );

      let total = 0;
      const categoryBreakdown = {};
      filteredByMonth.forEach(expense => {
        total += expense.amount;
        categoryBreakdown[expense.category] = (categoryBreakdown[expense.category] || 0) + expense.amount;
      });

      let reportHTML = `<p><strong>‡¶Æ‡¶æ‡¶∏: ${year}-${month}</strong></p>`;
      reportHTML += `<p>‡¶Æ‡ßã‡¶ü ‡¶ñ‡¶∞‡¶ö: ${total.toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ</p>`;
      reportHTML += '<p><strong>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶ñ‡¶∞‡¶ö:</strong></p><ul>';
      for (const [category, amount] of Object.entries(categoryBreakdown)) {
        reportHTML += `<li>${category}: ${amount.toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ</li>`;
      }
      reportHTML += '</ul>';

      document.getElementById('monthlyReport').innerHTML = reportHTML;
    }

    // ‡¶™‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶π‡¶≤‡ßá ‡¶ñ‡¶∞‡¶ö‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
    renderExpenses();
    document.getElementById('reportMonth').addEventListener('change', generateMonthlyReport);
  </script>
</body>
</html>